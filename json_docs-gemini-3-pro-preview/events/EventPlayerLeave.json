{
  "name": "EventPlayerLeave",
  "fullClassName": "EventPlayerLeave",
  "extends": null,
  "since": null,
  "description": "This event is fired when a player leaves the server.",
  "overview": "Backed by class `EventPlayerLeave`.\n\n## Event payload\n\n| Field  | Type                    | Description                              |\n| ------ | ----------------------- | ---------------------------------------- |\n| UUID   | string                  | The UUID of the leaving player           |\n| player | PlayerListEntryHelper   | Helper object for the leaving player     |\n\n## Behavior\n\n* Fires when any player leaves the server (including yourself on disconnect)\n- The `UUID` field contains the player's unique identifier\n- The `player` field provides access to player information\n- Not cancellable\n- Useful for farewell messages, cleanup, and tracking\n\n## Fields\n\n### event.UUID\n**Type:** `string`\nThe unique identifier for the leaving player. This is the player's UUID in string format. This is more reliable than name for tracking players across name changes and for cleanup operations.\n\n### event.player\n**Type:** `PlayerListEntryHelper`\nA helper object for the leaving player. This provides access to player information like name, game mode, ping, display name, and other server-side player data at the time they left.\n\n## Minimal example\n\n```js\nJsMacros.on(\"PlayerLeave\", JavaWrapper.methodToJavaAsync((e) => {\n  Chat.log(`${e.player.getName()} left the server!`);\n});\n```\n\n## Async example\n\n```js\nJsMacros.on(\"PlayerLeave\", JavaWrapper.methodToJavaAsync((e) => {\n  const player = e.player;\n  const playerName = player.getName();\n  const playerUUID = e.UUID;\n  const currentTime = new Date().toLocaleString();\n\n  Chat.log(`&cPlayer Left: &f${playerName}`);\n  Chat.log(`&7UUID: &f${playerUUID.substring(0, 8)}...`);\n  Chat.log(`&7Time: &f${currentTime}`);\n\n  // Check if it's the local player\n  const localPlayerName = Player.getPlayer().getName();\n  if (playerName === localPlayerName) {\n    Chat.log(`&6You have left the server, ${playerName}!`);\n    Chat.actionbar(`&cYou have disconnected from the server`);\n\n    // Clean up session data\n    if (global.sessionStartTime) {\n      const sessionDuration = Date.now() - global.sessionStartTime;\n      const sessionMinutes = Math.floor(sessionDuration / 60000);\n      Chat.log(`&7Session duration: &f${sessionMinutes} &7minutes`);\n      delete global.sessionStartTime;\n    }\n  } else {\n    // Handle other players leaving\n    Chat.log(`&6${playerName} &fhas left the server!`);\n    Chat.actionbar(`&c${playerName} &7left the server`);\n\n    // Check if this was a friend\n    if (isFriend(playerName)) {\n      Chat.log(`&bYour friend ${playerName} has gone offline!`);\n      Chat.actionbar(`&bðŸ‘‹ ${playerName} has left`);\n    }\n\n    // Check if this was staff\n    if (isStaff(playerName)) {\n      Chat.log(`&eStaff member ${playerName} has gone offline!`);\n      Chat.actionbar(`&eðŸ›¡ï¸ ${playerName} (Staff) has left`);\n    }\n\n    // Log farewell for known players\n    if (shouldLogLeave(playerName)) {\n      Chat.log(`&8[Leave Log] ${playerName} (${playerUUID.substring(0, 8)}...) left at ${currentTime}`);\n    }\n  }\n\n  // Calculate play time if we tracked their join time\n  const playTime = calculatePlayTime(playerName, playerUUID);\n  if (playTime > 0) {\n    const hours = Math.floor(playTime / 3600000);\n    const minutes = Math.floor((playTime % 3600000) / 60000);\n\n    if (hours > 0) {\n      Chat.log(`&7Play time: &f${hours}h ${minutes}m`);\n    } else {\n      Chat.log(`&7Play time: &f${minutes} &7minutes`);\n    }\n  }\n\n  // Clean up player-specific data\n  cleanupPlayerData(playerName, playerUUID);\n\n  // Update online player count\n  updateOnlinePlayerCount();\n\n  // Check if server is getting empty\n  const playerCount = World.getPlayerCount();\n  if (playerCount <= 2) {\n    Chat.log(`&6Server is now quiet with only ${playerCount} players online`);\n  }\n\n  // Log for statistics\n  updateLeaveStats(playerName, currentTime);\n}));\n\nfunction isFriend(playerName) {\n  // Check against friends list\n  const friends = [\"Friend1\", \"Friend2\", \"Friend3\"]; // Replace with actual friends list\n  return friends.includes(playerName);\n}\n\nfunction isStaff(playerName) {\n  // Check against staff list\n  const staff = [\"Admin\", \"Moderator\", \"Helper\"]; // Replace with actual staff list\n  return staff.some(staffMember => playerName.toLowerCase().includes(staffMember.toLowerCase()));\n}\n\nfunction calculatePlayTime(playerName, uuid) {\n  // This would calculate the time the player was online\n  // Implementation would depend on how you track join times\n  // For example, if you stored join times in a map:\n  const joinTime = global.playerJoinTimes && global.playerJoinTimes[uuid];\n  if (joinTime) {\n    const playTime = Date.now() - joinTime;\n    delete global.playerJoinTimes[uuid]; // Clean up\n    return playTime;\n  }\n  return 0;\n}\n\nfunction cleanupPlayerData(playerName, uuid) {\n  // Clean up any tracked data for this player\n  // This could include:\n  // - Temporary markers\n  // - Chat histories\n  // - Interaction logs\n  // - Custom tracking data\n\n  if (global.playerData && global.playerData[uuid]) {\n    delete global.playerData[uuid];\n  }\n\n  if (global.playerInteractions && global.playerInteractions[playerName]) {\n    delete global.playerInteractions[playerName];\n  }\n}\n\nfunction updateOnlinePlayerCount() {\n  // Update and display current online player count\n  const playerCount = World.getPlayerCount();\n  Chat.log(`&7Players online: &f${playerCount}`);\n\n  // Could also update a HUD element or external display\n}\n\nfunction shouldLogLeave(playerName) {\n  // Define criteria for when to log leaves\n  return isStaff(playerName) || isFriend(playerName);\n}\n\nfunction updateLeaveStats(playerName, currentTime) {\n  // Update persistent statistics\n  // Could track things like:\n  // - Total leaves per day\n  // - Peak online times\n  // - Average session durations\n  // - Player retention\n\n  if (!global.leaveStats) {\n    global.leaveStats = {};\n  }\n\n  const today = new Date().toDateString();\n  if (!global.leaveStats[today]) {\n    global.leaveStats[today] = 0;\n  }\n\n  global.leaveStats[today]++;\n}\n\n// Example companion function to track when players join\nJsMacros.on(\"PlayerJoin\", JavaWrapper.methodToJavaAsync((e) => {\n  // Store join time for play time calculation\n  if (!global.playerJoinTimes) {\n    global.playerJoinTimes = {};\n  }\n  global.playerJoinTimes[e.UUID] = Date.now();\n}));\n```",
  "constructors": [],
  "methods": [
    {
      "name": "toString",
      "signature": "toString()",
      "returnType": "string",
      "description": "Returns a string representation of the event object.",
      "parameters": [],
      "static": false,
      "examples": []
    }
  ]
}