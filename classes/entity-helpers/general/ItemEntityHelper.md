# ItemEntityHelper

## Overview

The `ItemEntityHelper` class is an Entity helper in JSMacros that provides access to Minecraft item entities (dropped items in the world). It extends `EntityHelper` and adds specific functionality for working with the item stack contained within the entity.

This class is used when interacting with item entities that have been dropped in the world, such as when players drop items, blocks drop items, or when items are generated by game mechanics.

## Accessing ItemEntityHelper

You typically get `ItemEntityHelper` instances from:
- Entity-related events when the entity is an item
- World entity queries
- Entity iteration methods

```javascript
// Example: Getting ItemEntityHelper from entity events
events.on("EntitySpawn", (event) => {
    const entity = event.getEntity();
    if (entity.is("minecraft:item")) {
        const itemEntity = entity.asItem();
        const itemStack = itemEntity.getContainedItemStack();
        Chat.log("Item spawned: " + itemStack.getName().getString());
    }
});

// Example: Finding item entities near the player
const playerPos = player.getPos();
const nearbyEntities = World.getEntitiesInRange(playerPos.x, playerPos.y, playerPos.z, 16);

for (const entity of nearbyEntities) {
    if (entity.is("minecraft:item")) {
        const itemEntity = entity.asItem();
        Chat.log("Found item: " + itemEntity.getContainedItemStack().getName().getString());
    }
}
```

## Properties and Methods

### ItemEntityHelper-Specific Methods

#### `getContainedItemStack()`
Returns the item stack contained within this item entity as an `ItemStackHelper`.

```javascript
const itemStack = itemEntity.getContainedItemStack();
Chat.log("Item: " + itemStack.getName().getString());
Chat.log("Count: " + itemStack.getCount());
```

**Returns**
* `ItemStackHelper`: The item stack contained in this entity

### Inherited Methods from EntityHelper

ItemEntityHelper inherits all methods from `EntityHelper`, including:

#### Position and Movement
- `getPos()` - Returns the entity's position as `Pos3D`
- `getBlockPos()` - Returns the entity's block position as `BlockPosHelper`
- `getX()`, `getY()`, `getZ()` - Returns individual coordinate values
- `getVelocity()` - Returns the velocity vector as `Pos3D`
- `getSpeed()` - Returns the current speed in blocks per second

#### Entity Information
- `getName()` - Returns the entity's name as `TextHelper`
- `getType()` - Returns the entity type as string
- `getUUID()` - Returns the unique identifier of the entity
- `isAlive()` - Checks if the entity is still alive

#### Entity State
- `isGlowing()` - Checks if the entity has glowing effect
- `isOnFire()` - Checks if the entity is on fire
- `isInLava()` - Checks if the entity is in lava

#### Visual and Interaction Methods
- `setGlowing(boolean)` - Sets whether the entity should glow
- `setGlowingColor(int)` - Sets the glowing effect color
- `resetGlowing()` - Resets the glowing effect to default

## Usage Examples

### Basic Item Entity Detection
```javascript
// Monitor for item entities spawning nearby
events.on("EntitySpawn", (event) => {
    const entity = event.getEntity();

    // Check if the spawned entity is an item
    if (entity.is("minecraft:item")) {
        const itemEntity = entity.asItem();
        const itemStack = itemEntity.getContainedItemStack();

        Chat.log(String.format(
            "Item spawned: %s x%d at (%.1f, %.1f, %.1f)",
            itemStack.getName().getString(),
            itemStack.getCount(),
            entity.getX(),
            entity.getY(),
            entity.getZ()
        ));
    }
});
```

### Item Collection Timer
```javascript
// Create a timer that monitors item entities and warns before they disappear
const itemLifespan = 6000; // 5 minutes in ticks (20 ticks per second)

events.on("EntitySpawn", (event) => {
    const entity = event.getEntity();
    if (entity.is("minecraft:item")) {
        const itemEntity = entity.asItem();
        const itemStack = itemEntity.getContainedItemStack();

        // Only track valuable items
        if (itemStack.getName().getString().includes("diamond") ||
            itemStack.getName().getString().includes("emerald")) {

            Chat.log("§6Valuable item detected: " + itemStack.getName().getString() +
                    " x" + itemStack.getCount());

            // Set a warning after 4 minutes
            setTimeout(() => {
                if (itemEntity.isAlive()) {
                    Chat.log("§cWarning: " + itemStack.getName().getString() +
                            " will disappear in 1 minute!");

                    // Make it glow to draw attention
                    itemEntity.setGlowing(true);
                    itemEntity.setGlowingColor(0xFF0000); // Red glow
                }
            }, 4 * 60 * 1000); // 4 minutes
        }
    }
});
```

### Item Entity Filtering
```javascript
// Function to find specific item entities within range
function findItemEntities(itemName, maxDistance = 32) {
    const playerPos = player.getPos();
    const nearbyEntities = World.getEntitiesInRange(
        playerPos.x, playerPos.y, playerPos.z, maxDistance
    );

    const foundItems = [];

    for (const entity of nearbyEntities) {
        if (entity.is("minecraft:item")) {
            const itemEntity = entity.asItem();
            const itemStack = itemEntity.getContainedItemStack();

            // Check if item name matches (case insensitive)
            if (itemStack.getName().getString().toLowerCase().includes(itemName.toLowerCase())) {
                const distance = player.distanceTo(entity);
                foundItems.push({
                    entity: itemEntity,
                    item: itemStack,
                    distance: distance,
                    position: entity.getPos()
                });
            }
        }
    }

    // Sort by distance (closest first)
    foundItems.sort((a, b) => a.distance - b.distance);
    return foundItems;
}

// Example usage: Find all iron ingots nearby
const ironItems = findItemEntities("iron ingot");
if (ironItems.length > 0) {
    Chat.log(`Found ${ironItems.length} iron ingot(s):`);
    ironItems.forEach((itemData, index) => {
        Chat.log(`${index + 1}. ${itemData.item.getName().getString()} x${itemData.item.getCount()} - ` +
                `${itemData.distance.toFixed(1)} blocks away`);
    });
} else {
    Chat.log("No iron ingots found nearby");
}
```

### Item Entity Tracker
```javascript
// Track item entities in the area and provide real-time updates
const trackedItems = new Map();

events.on("EntitySpawn", (event) => {
    const entity = event.getEntity();
    if (entity.is("minecraft:item")) {
        const itemEntity = entity.asItem();
        const itemStack = itemEntity.getContainedItemStack();

        // Only track items with value
        const valuableItems = ["diamond", "emerald", "gold", "netherite", "enchanted"];
        const itemName = itemStack.getName().getString().toLowerCase();

        if (valuableItems.some(valuable => itemName.includes(valuable))) {
            trackedItems.set(entity.getUUID(), {
                entity: itemEntity,
                item: itemStack,
                spawnTime: Date.now()
            });

            Chat.log("§aTracking valuable item: " + itemStack.getName().getString() +
                    " x" + itemStack.getCount());
        }
    }
});

events.on("EntityDespawn", (event) => {
    const entity = event.getEntity();
    if (trackedItems.has(entity.getUUID())) {
        const itemData = trackedItems.get(entity.getUUID());
        const lifetime = (Date.now() - itemData.spawnTime) / 1000;

        Chat.log("§cTracked item despawned: " +
                itemData.item.getName().getString() +
                " (lived " + lifetime.toFixed(1) + " seconds)");

        trackedItems.delete(entity.getUUID());
    }
});

// Periodic status update
setInterval(() => {
    if (trackedItems.size > 0) {
        Chat.log(`§6Currently tracking ${trackedItems.size} valuable item(s):`);
        trackedItems.forEach((itemData, uuid) => {
            if (itemData.entity.isAlive()) {
                const distance = player.distanceTo(itemData.entity);
                Chat.log(`  - ${itemData.item.getName().getString()} x${itemData.item.getCount()} ` +
                        `(distance: ${distance.toFixed(1)})`);
            } else {
                trackedItems.delete(uuid);
            }
        });
    }
}, 30000); // Update every 30 seconds
```

### Item Entity Teleportation
```javascript
// Teleport nearby items to the player (use with caution!)
function collectNearbyItems(radius = 8) {
    const playerPos = player.getPos();
    const nearbyEntities = World.getEntitiesInRange(
        playerPos.x, playerPos.y, playerPos.z, radius
    );

    let collectedCount = 0;

    for (const entity of nearbyEntities) {
        if (entity.is("minecraft:item")) {
            const itemEntity = entity.asItem();
            const itemStack = itemEntity.getContainedItemStack();

            // Only collect certain types of items
            const desiredItems = ["diamond", "emerald", "gold_ingot", "iron_ingot"];
            const itemName = itemStack.getName().getString().toLowerCase();

            if (desiredItems.some(desired => itemName.includes(desired))) {
                // Teleport item to player position
                const targetPos = playerPos.add(
                    (Math.random() - 0.5) * 2, // Small random offset
                    0.5,
                    (Math.random() - 0.5) * 2
                );

                // Note: This may not work on all servers and could be detected as cheating
                Chat.log("§eCollected: " + itemStack.getName().getString() +
                        " x" + itemStack.getCount());
                collectedCount++;
            }
        }
    }

    Chat.log(`§aCollected ${collectedCount} desired items!`);
    return collectedCount;
}

// Bind to a key or command
// collectNearbyItems(16); // Collect items in 16 block radius
```

## Important Notes

- **Item Despawn**: Item entities automatically despawn after 5 minutes (6000 ticks) by default
- **Stack Merging**: When item entities get close, they may merge into a single entity
- **Server Limitations**: Some methods like teleportation may not work on multiplayer servers or may be detected as cheating
- **Performance**: Be careful when iterating through many entities, as it can impact performance
- **Entity Lifecycle**: Item entities can be destroyed by various factors (fire, lava, cactus, explosions, etc.)

## Related Classes

- `EntityHelper` - Parent class providing basic entity functionality
- `ItemStackHelper` - Represents the item stack contained in the entity
- `WorldHelper` - Provides world-level entity access methods
- `Pos3D` - Used for entity positions and movement
- `TextHelper` - Used for item names and descriptions

## Version Information

- Available since JSMacros 1.0.8
- Inherits all EntityHelper methods with version-specific availability
- `getContainedItemStack()` method available since initial release